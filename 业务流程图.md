# 后端生成逻辑业务流程图

本项目后端生成逻辑主要集成在 `services/geminiService.ts` 中，使用 Google Gemini API 进行多模态内容生成。

## 1. 文字生成 (Text Generation)

- **模型**: `gemini-3-flash-preview`
- **逻辑**: 发送 Prompt，附带系统指令 ("You are a world-class e-commerce copywriter...")。

```mermaid
sequenceDiagram
    participant Frontend as 前端 (UI)
    participant Service as GeminiService
    participant API as Google Gemini API

    Frontend->>Service: generateContent(prompt, TEXT)
    Service->>API: generateContent(model='gemini-3-flash-preview', prompt, systemInstruction)
    API-->>Service: 返回生成的文本
    Service-->>Frontend: 返回文本内容
```

## 2. 图片生成 (Image Generation)

- **模型**: `gemini-2.5-flash-image`
- **配置**: 16:9 宽高比
- **逻辑**: 请求生成图片，解析返回的 base64 数据。

```mermaid
sequenceDiagram
    participant Frontend as 前端 (UI)
    participant Service as GeminiService
    participant API as Google Gemini API

    Frontend->>Service: generateContent(prompt, IMAGE)
    Service->>API: generateContent(model='gemini-2.5-flash-image', prompt)
    API-->>Service: 返回包含 inlineData (Base64) 的响应
    Service->>Service: 拼接 "data:image/png;base64,..."
    Service-->>Frontend: 返回 Base64 图片 URL
```

## 3. 视频生成 (Video Generation)

- **模型**: `veo-3.1-fast-generate-preview`
- **逻辑**: 异步生成，需要轮询操作状态，完成后下载视频 Blob。

```mermaid
sequenceDiagram
    participant Frontend as 前端 (UI)
    participant Service as GeminiService
    participant API as Google Gemini API

    Frontend->>Service: generateContent(prompt, VIDEO)
    Service->>API: generateVideos(model='veo-3.1...', prompt)
    API-->>Service: 返回 Operation 对象

    loop 每10秒轮询
        Service->>API: getVideosOperation(operation)
        API-->>Service: 返回最新状态
    end

    Service->>API: 获取 downloadLink
    Service->>API: fetch(downloadLink) (下载视频流)
    API-->>Service: 返回 Video Blob
    Service->>Service: URL.createObjectURL(blob)
    Service-->>Frontend: 返回本地 Blob URL
```

## 4. 搜索/市场洞察 (Search Insight)

- **模型**: `gemini-3-flash-preview`
- **工具**: `googleSearch`
- **逻辑**: 使用 Google Search Tool 增强回答。

```mermaid
sequenceDiagram
    participant Frontend as 前端 (UI)
    participant Service as GeminiService
    participant API as Google Gemini API

    Frontend->>Service: generateContent(prompt, SEARCH)
    Service->>API: generateContent(model='gemini-3-flash-preview', tools=[googleSearch])
    API-->>Service: 返回结合搜索结果的文本
    Service-->>Frontend: 返回文本内容
```
